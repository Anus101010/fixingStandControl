-- 1) Locations — создаём и не даём игре потерять
do
    local function ensureLocations()
        if not workspace:FindFirstChild("Locations") then
            local f = Instance.new("Folder")
            f.Name = "Locations"
            f.Parent = workspace
        end
    end
    ensureLocations()
    task.spawn(function()
        while true do
            task.wait(0.5)
            ensureLocations()
        end
    end)
end

pcall(function()
    local black = game:GetService("Players").LocalPlayer:FindFirstChild("PlayerGui") and game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("BlackScreen")
    if black then
        local te = black:FindFirstChild("TimeErase") or Instance.new("Frame")
        if te.Name ~= "TimeErase" then te.Name = "TimeErase"; te.Parent = black end
        if not te:FindFirstChild("TE1") then
            local te1 = Instance.new("Frame"); te1.Name = "TE1"; te1.Parent = te
        end
    end
end)

-- Минимальный Xenon Utils только для нужных фич
local Xenon = { Utils = {} }
Xenon.__index = Xenon
Xenon.Utils.__index = Xenon.Utils

local Library = loadstring(game:HttpGet("https://pastebin.com/raw/9YwM8kt6"))()

function Xenon.Utils.MakeUtilController()
    local Utils = {
        Tasks = {};
        Services = {};
        States = {};
        Ints = {};
    }
    Utils.Services = setmetatable({}, {
        __index = function(self, service)
            if rawget(self, service) then return rawget(self, service) end
            local GotService = game:GetService(service)
            self[service] = GotService
            return self[service]
        end
    })
    return setmetatable(Utils, Xenon.Utils)
end

function Xenon.Utils:GetService(Service)
    return self.Services[Service]
end

function Xenon.Utils:GetPlayer()
    return self:GetService("Players").LocalPlayer
end

function Xenon.Utils:GetCharacter()
    return self:GetPlayer().Character or self:GetPlayer().CharacterAdded:Wait()
end

function Xenon.Utils:GetHumanoid()
    local Character = self:GetCharacter()
    if Character then
        return Character:FindFirstChildWhichIsA("Humanoid")
    end
end

function Xenon.Utils:GetHRP()
    local Character = self:GetCharacter()
    if Character then
        return Character:FindFirstChild("HumanoidRootPart")
    end
end

function Xenon.Utils:GetState(Value)
    if self.States[Value] then
        return self.States[Value].Value
    end
    return nil
end

function Xenon.Utils:SetState(Value, NewValue)
    if self.States[Value] then
        self.States[Value].Value = NewValue
    end
end

function Xenon.Utils:GetInt(Value)
    if self.Ints[Value] then
        return self.Ints[Value].Value
    end
    return nil
end

function Xenon.Utils:SetInt(Value, NewValue)
    if self.Ints[Value] then
        self.Ints[Value].Value = NewValue
    end
end

function Xenon.Utils:AddTask(TaskName, Task)
    if not self.Tasks[TaskName] then
        self.Tasks[TaskName] = Task
    end
    return Task
end

function Xenon.Utils:IsTaskRunning(TaskName)
    if self.Tasks[TaskName] then
        return self.Tasks[TaskName].Connected
    end
    return false
end

function Xenon.Utils:DisconnectTask(TaskName)
    if self:IsTaskRunning(TaskName) then
        self.Tasks[TaskName]:Disconnect()
        self.Tasks[TaskName] = nil
    end
end

function Xenon.Utils:GetStroke()
    local StrokeDir = 180
    local Anim = "6926086304"
    local UIS = game:GetService("UserInputService")
    if UIS:IsKeyDown(Enum.KeyCode.A) then
        StrokeDir = 90
        Anim = "6926086567"
    elseif UIS:IsKeyDown(Enum.KeyCode.D) and StrokeDir == 180 then
        StrokeDir = -90
        Anim = "6926086883"
    elseif UIS:IsKeyDown(Enum.KeyCode.W) and StrokeDir == 180 then
        StrokeDir = 0
        Anim = "6926086032"
    end
    return StrokeDir, Anim
end

function Xenon.Utils:Outline(Chars)
    local Highlight = Instance.new("Highlight", self:GetService("CoreGui").GayESP)
    Highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    Highlight.Adornee = Chars
    Highlight.FillColor = Color3.fromRGB(255, 255, 255)
    Highlight.FillTransparency = 1
end

function Xenon.Utils:LabelChar(Chars)
    local BGui = Instance.new("BillboardGui", self:GetService("CoreGui").GayESP)
    local Frame = Instance.new("Frame", BGui)
    local TextLabel = Instance.new("TextLabel", Frame)
    BGui.Adornee = Chars:WaitForChild("Head")
    BGui.StudsOffset = Vector3.new(0, 3, 0)
    BGui.AlwaysOnTop = true
    BGui.Size = UDim2.new(4, 0, 0.5, 0)
    Frame.Size = UDim2.new(1, 0, 1, 0)
    TextLabel.Size = UDim2.new(1, 0, 1, 0)
    Frame.BackgroundTransparency = 1
    TextLabel.BackgroundTransparency = 1
    TextLabel.Text = Chars.Name
    TextLabel.Font = Enum.Font.Ubuntu
    TextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TextLabel.TextScaled = false
end

local Util = Xenon.Utils.MakeUtilController()

-- Только нужные значения
Util.States["Auto Sprinting"] = { Value = false }
Util.States["Infinite Dash"] = { Value = false }
Util.Ints["InfTick"] = { Value = tick() }
Util.Ints["InfDelay"] = { Value = 1 }
Util.Ints["DashPower"] = { Value = 50 }

-- Меню: только 2 вкладки
local Lib = Library.CreateLib()

local PlayerTab = Lib:Tab("Player", 6023426915)
local MiscTab = Lib:Tab("Misc", 6022668951)

-- Player: только Auto Sprint и Player ESP
local Player_Section = PlayerTab:Section("Player")

Player_Section:Toggle("Auto Sprint", false, function(State)
    Util:SetState("Auto Sprinting", State)
    while Util:GetState("Auto Sprinting") == true and Util:GetCharacter() do
        task.wait()
        local ok, result = pcall(function()
            if Util:GetCharacter() and Util:GetCharacter():FindFirstChild("RemoteFunction") then
                local ret = Util:GetCharacter().RemoteFunction:InvokeServer("ReturnSprint")
                if ret and ret.IsSprinting ~= true then
                    Util:GetCharacter().RemoteFunction:InvokeServer("ToggleSprinting")
                end
            end
        end)
    end
end, "Toggles auto sprint")

Player_Section:Toggle("Player ESP", false, function(State)
    if State == true then
        local Folder = Instance.new("Folder", Util:GetService("CoreGui"))
        Folder.Name = "GayESP"
        for i, v in pairs(Util:GetService("Players"):GetPlayers()) do
            if v ~= Util:GetPlayer() then
                Util:AddTask("Chr", v.CharacterAdded:Connect(function(Chars)
                    Util:Outline(Chars)
                    Util:LabelChar(Chars)
                end))
                if v.Character then
                    Util:Outline(v.Character)
                    Util:LabelChar(v.Character)
                end
            end
        end
        Util:AddTask("Chr2", Util:GetService("Players").PlayerAdded:Connect(function(Player)
            Player.CharacterAdded:Connect(function(Chars)
                Util:Outline(Chars)
                Util:LabelChar(Chars)
            end)
        end))
    else
        local gui = Util:GetService("CoreGui"):FindFirstChild("GayESP")
        if gui then gui:Destroy() end
        Util:DisconnectTask("Chr")
        Util:DisconnectTask("Chr2")
    end
end, "Turns on name ESP for players")

-- Misc: только Infinite Dash + Dash Power + Dash Delay
local Misc_Dash = MiscTab:Section("Dash")

local DashAnimsFolder = Instance.new("Folder", workspace)

Misc_Dash:Toggle("Infinite Dash", false, function(State)
    Util:SetState("Infinite Dash", State)
    if Util:GetState("Infinite Dash") == true then
        Util:AddTask("InfDash", game:GetService("UserInputService").InputBegan:Connect(function(Input, GameProcessed)
            if GameProcessed then return end
            local plr = Util:GetPlayer()
            if not plr.Character then return end
            local dashKey = plr:FindFirstChild("PlayerStats") and plr.PlayerStats:FindFirstChild("DashKey")
            if not dashKey then return end
            if Input.KeyCode == Enum.KeyCode[dashKey.Value] and (tick() - Util:GetInt("InfTick")) >= Util:GetInt("InfDelay") then
                Util:SetInt("InfTick", tick())
                local Dir, AnimId = Util:GetStroke()
                local Anim = Instance.new("Animation", DashAnimsFolder)
                Anim.Name = "YBA_AntiCheat_Bypass_REAL"
                Anim.AnimationId = "rbxassetid://" .. AnimId
                local Anim2 = Util:GetHumanoid():LoadAnimation(Anim)
                Anim2:Play()
                local bv = Instance.new("BodyVelocity", Util:GetHRP())
                bv.Velocity = (Util:GetHRP().CFrame * CFrame.Angles(0, math.rad(Dir), 0)).LookVector * Util:GetInt("DashPower")
                bv.MaxForce = Vector3.new(55555, 1000, 55555)
                game:GetService("Debris"):AddItem(bv, 0.25)
            end
        end))
    else
        Util:DisconnectTask("InfDash")
    end
end, "Toggles custom dash")

Misc_Dash:Slider("Dash Power", 10, 1000, 50, function(Value)
    Util:SetInt("DashPower", Value)
end, false, "Set dash power")

Misc_Dash:Slider("Dash Delay", 0, 3.5, 1, function(Value)
    Util:SetInt("InfDelay", Value)
end, true, "Set dash delay")

-- Нижняя панель: статус и брендинг
pcall(function()
    local gui = game:GetService("CoreGui"):FindFirstChild("XenonV3Lib")
    if gui and gui:FindFirstChild("TabHolder") and gui.TabHolder:FindFirstChild("Status") then
        gui.TabHolder.Status.Label.Text = "Status: Loaded!"
    end
end)
